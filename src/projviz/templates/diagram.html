{% extends "base.html" %}

{% block title %}Project Diagram - {{ project_name }}{% endblock %}

{% block header_title %}Project Overview{% endblock %}

{% block header_subtitle %}
<p>Project: {{ project_name }}</p>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-2">
  <div class="h5 mb-0"><i class="bi bi-diagram-3 me-2 text-primary"></i>Structure Summary</div>
  <a class="btn btn-sm btn-outline-primary" href="/">Back to Tree</a>
  </div>
<div id="diagram_cards" class="row g-3"></div>
{% endblock %}

{% block scripts %}
<script>
(function(){
  function $(id){ return document.getElementById(id); }
  function fileIconClass(name){
    var lower = (name || '').toLowerCase();
    if (lower.endsWith('.py')) return 'bi-filetype-py';
    if (lower.endsWith('.js')) return 'bi-filetype-js';
    if (lower.endsWith('.ts')) return 'bi-filetype-ts';
    if (lower.endsWith('.json')) return 'bi-filetype-json';
    if (lower.endsWith('.md')) return 'bi-filetype-md';
    if (lower.endsWith('.html') || lower.endsWith('.htm')) return 'bi-filetype-html';
    if (lower.endsWith('.css')) return 'bi-filetype-css';
    if (lower.endsWith('.txt')) return 'bi-filetype-txt';
    if (lower.endsWith('.yml') || lower.endsWith('.yaml')) return 'bi-filetype-yml';
    if (lower.endsWith('.zip') || lower.endsWith('.tar') || lower.endsWith('.gz') || lower.endsWith('.whl') || lower.endsWith('.7z')) return 'bi-file-zip';
    if (lower.endsWith('.png') || lower.endsWith('.jpg') || lower.endsWith('.jpeg') || lower.endsWith('.gif') || lower.endsWith('.svg')) return 'bi-file-image';
    if (lower.endsWith('.lock')) return 'bi-lock-fill';
    return 'bi-file-earmark';
  }
  function fileColorClass(name){
    var lower = (name || '').toLowerCase();
    if (lower.endsWith('.py')) return 'text-primary';
    if (lower.endsWith('.js')) return 'text-warning';
    if (lower.endsWith('.ts')) return 'text-info';
    if (lower.endsWith('.json')) return 'text-success';
    if (lower.endsWith('.zip') || lower.endsWith('.tar') || lower.endsWith('.gz') || lower.endsWith('.whl') || lower.endsWith('.7z')) return 'text-warning';
    if (lower.endsWith('.md')) return 'text-secondary';
    if (lower.endsWith('.html') || lower.endsWith('.htm')) return 'text-danger';
    if (lower.endsWith('.css')) return 'text-info';
    if (lower.endsWith('.txt')) return 'text-muted';
    if (lower.endsWith('.yml') || lower.endsWith('.yaml')) return 'text-warning';
    if (lower.endsWith('.png') || lower.endsWith('.jpg') || lower.endsWith('.jpeg') || lower.endsWith('.gif') || lower.endsWith('.svg')) return 'text-danger';
    if (lower.endsWith('.lock')) return 'text-muted';
    return 'text-primary';
  }

  fetch('/api/tree').then(function(r){ return r.json(); }).then(function(data){
    var root = Array.isArray(data) ? data[0] : data;
    var cards = $('diagram_cards');
    cards.innerHTML = '';
    // List top-level folders/files as cards
    var nodes = (root && root.data) ? root.data : [];
    nodes.forEach(function(n){
      var col = document.createElement('div');
      col.className = 'col-12 col-sm-6 col-md-4 col-lg-3';
      var card = document.createElement('div');
      card.className = 'card h-100 shadow-sm neu-surface';
      var body = document.createElement('div');
      body.className = 'card-body d-flex flex-column justify-content-between neu-surface';
      var icon = document.createElement('div');
      icon.className = 'display-6 mb-2 ' + (n.type === 'folder' ? 'text-warning' : fileColorClass(n.value));
      icon.innerHTML = '<i class="bi ' + (n.type === 'folder' ? 'bi-folder-fill' : fileIconClass(n.value)) + '"></i>';
      var title = document.createElement('div');
      title.className = 'fw-semibold text-truncate';
      title.textContent = n.value;
      var small = document.createElement('div');
      small.className = 'text-muted small';
      small.textContent = (n.type === 'folder' ? 'Folder' : 'File') + (n.path ? ' â€¢ ' + n.path : '');
      body.appendChild(icon);
      body.appendChild(title);
      body.appendChild(small);
      card.appendChild(body);
      col.appendChild(card);
      cards.appendChild(col);
    });
  }).catch(function(){
    var cards = $('diagram_cards');
    cards.innerHTML = '<div class="col-12"><div class="alert alert-danger">Failed to load data</div></div>';
  });
})();
</script>
{% endblock %}
